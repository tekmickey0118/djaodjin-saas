{% extends "saas/base.html" %}

{% block saas_bodyscripts %}
<script type="text/javascript" charset="utf-8" src="{{'static/vendor/js/angular.js'|asset}}"></script>
<script type="text/javascript" charset="utf-8" src="{{'static/vendor/js/angular-touch.js'|asset}}"></script>
<script type="text/javascript" charset="utf-8" src="{{'static/vendor/js/angular-animate.js'|asset}}"></script>
<script type="text/javascript" charset="utf-8" src="{{'static/vendor/js/angular-resource.js'|asset}}"></script>
<script type="text/javascript" charset="utf-8" src="{{'static/vendor/js/angular-route.js'|asset}}"></script>
<script type="text/javascript" charset="utf-8" src="{{'static/vendor/js/angular-dragdrop.js'|asset}}"></script>
<script type="text/javascript" charset="utf-8" src="{{'static/vendor/js/ui-bootstrap-tpls.js'|asset}}"></script>
<script type="text/javascript" charset="utf-8" src="{{'static/js/djaodjin-saas-angular.js'|asset}}"></script>
{% if organization %}
{# XXX /users/:user/products/ page does not define ``organization``. #}
<script type="text/javascript">
/* Implementation Note: Not including a list of dependent modules
   (2nd parameter to `module`) "re-opens" the module for additional
   configuration.
   - We add the CSRF token for as an HTTP header on API calls.
   - We make it easier to separate between django and angularjs templates
     by changing Angular defaults to [[ and ]] characters. */
var reopenSaasApp = angular.module('saasApp');
reopenSaasApp.config(['$interpolateProvider', '$httpProvider',
           function($interpolateProvider, $httpProvider) {
    $httpProvider.defaults.headers.common['X-CSRFToken'] = '{{csrf_token}}';
    $interpolateProvider.startSymbol('[[');
    $interpolateProvider.endSymbol(']]');
}]);
reopenSaasApp.constant('settings', {
urls: {
    api_balance_lines: "{{urls.api_balance_lines}}",
    api_broker_balances: "{{urls.api_broker_balances}}",
    api_transactions: "{{saas_api_transactions}}",
{% if urls.organization %}
{% if urls.organization.api_roles %}
    saas_api_user_relation_url: "{{ urls.organization.api_roles }}",
{% endif %}
    /* subscriptions */
    saas_api_profile: "{{ urls.organization.api_profile_base }}",
    saas_api_subscriptions: "{{ urls.organization.api_subscriptions }}",
{% endif %}
{% if urls.provider %}
    saas_api_coupon_url: "{{ urls.provider.api_coupons }}",
    saas_metrics_coupons_url: "{{ urls.provider.coupons }}",
    /* subscribers */
    saas_api_registered: "{{ urls.provider.api_users_registered }}",
    saas_api_churned: "{{ urls.provider.api_subscribers_churned }}",
    saas_api_active_subscribers: "{{ urls.provider.api_subscribers_active }}",
    /* transactions */
    api_receivables: "{{urls.provider.api_receivables}}",
    saas_api_bank: "{{ urls.provider.api_bank }}",
    /* users */
    api_users: "{{ urls.provider.api_users }}"
{% endif %}
},
tables: {% if tables %}{{tables|safe}}{% else %}{}{% endif %}, // XXX
date_range: {
    start_at: {% if start_at %}"{{start_at}}"{% else %}""{% endif %},
    ends_at: {% if ends_at %}"{{ends_at}}"{% else %}""{% endif %}
}});
</script>
{% endif %}
{% block dashboard_bodyscripts %}{% endblock %}
{% endblock %}

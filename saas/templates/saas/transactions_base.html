{% extends "saas/base.html" %}
{% load saas_tags %}

{% block saas_content %}
<section id="transactions" ng-app="transactionApp">
  <div ng-controller="transactionListCtrl">
    {% block saas_transaction_content %}
    {% endblock %}
    <h1>Transactions</h1>
    <a id="download" href="{{download_url}}?q=[[filterExpr]]&start_at=[[params.start_at]]&ends_at=[[params.ends_at]]" role="button">CSV Download</a>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Amount</th>
          <th>Description</th>
          <th><label>Filter</label> <input type="text" ng-model="filterExpr" ng-change="filterList(filterExpr)" /></th>
        </tr>
      </thead>
      <tbody ng-show="transactions.$resolved && transactions.results.length == 0">
        <tr>
          <td colspan="3">
            <h4 class="text-center"><em>No transactions<span ng-show="filterExpr"> [[filterExpr]]</span></em></h4>
          </td>
        </tr>
      </tbody>
      <tbody id="has-transactions" ng-show="transactions.$resolved && transactions.results.length > 0">
        <tr ng-repeat="entry in transactions.results">
          <td>[[entry.created_at | date : mediumDate]]</td>
          <td class="[[ entry.is_debit ? 'text-danger' : '']]">[[entry.amount]]</td>
          <td colspan="2" ng-bind-html="entry.description | unsafe"></td>
        </tr>
      </tbody>
    </table>
  </div>
</section>
{% endblock %}

{% block saas_bodyscripts %}
<script type="text/javascript">
/* Implementation Note: Not including a list of dependent modules
   (2nd parameter to `module`) "re-opens" the module for additional
   configuration. */
var app = angular.module('transactionApp');
/* Add the CSRF Token: */
app.config(['$interpolateProvider', '$httpProvider',
           function($interpolateProvider, $httpProvider) {
    $httpProvider.defaults.headers.common['X-CSRFToken'] = '{{ csrf_token|escapejs }}';
    /* Makes it easier to separate between django and angularjs templates */
    $interpolateProvider.startSymbol('[[');
    $interpolateProvider.endSymbol(']]');
}]);
app.filter('unsafe', function($sce) {
    return function(val) {
        return $sce.trustAsHtml(val);
    };
});
</script>
{% endblock %}
